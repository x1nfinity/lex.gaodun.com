import requests
import json
from typing import List, Dict

class DoubaoChat:
def **init**(self):
self.api_key = "bd747896-e89b-46f4-a5ab-0a232d086845"
self.endpoint_id = "ep-20251015101857-wc8xz"
self.api_url = "https://ark.cn-beijing.volces.com/api/v3/chat/completions"
self.conversation_history: List[Dict] = []

    def send_message(self, user_message: str) -> str:
        """发送消息并获取回复"""
        # 添加用户消息到历史
        self.conversation_history.append({
            "role": "user",
            "content": user_message
        })

        # 调用API
        headers = {
            "Content-Type": "application/json",
            "Authorization": f"Bearer {self.api_key}"
        }

        data = {
            "model": self.endpoint_id,
            "messages": self.conversation_history
        }

        response = requests.post(self.api_url, headers=headers, json=data)
        result = response.json()

        if response.status_code == 200:
            assistant_message = result['choices'][0]['message']['content']

            # 添加助手回复到历史
            self.conversation_history.append({
                "role": "assistant",
                "content": assistant_message
            })

            return assistant_message
        else:
            return f"错误: {result}"

    def reset_conversation(self):
        """重置对话历史"""
        self.conversation_history = []

    def set_system_prompt(self, system_prompt: str):
        """设置系统提示"""
        if self.conversation_history and self.conversation_history[0]['role'] == 'system':
            self.conversation_history[0] = {
                "role": "system",
                "content": system_prompt
            }
        else:
            self.conversation_history.insert(0, {
                "role": "system",
                "content": system_prompt
            })

# 使用示例

if **name** == "**main**":
bot = DoubaoChat()
bot.set_system_prompt("你是一个专业的编程助手，擅长Python和JavaScript开发。")

    print("对话机器人已启动！输入 'quit' 退出")

    while True:
        user_input = input("\n你: ")
        if user_input.lower() == 'quit':
            break

        response = bot.send_message(user_input)
        print(f"\n助手: {response}")
